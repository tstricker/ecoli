{
    "collab_server" : "",
    "contents" : "---\ntitle: \"ecoli.all\"\noutput: html_document\n---\n\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = TRUE)\n```\n\n## R Markdown\nE.coli  -- Analzye all data simultaneously\n\ndata was aligned to ecoli /data/strickt2/SEQreference/new_ecoli/uti89.final.fa with bwa. Reads were counted using htseq, with /data/strickt2/SEQreference/new_ecoli/Escherichia_coli_uti89.ASM1326v1.31.gff3 as a reference gtf. \nBelow, data is analyzed with DESeq2, using a model with terms for strain, time, and an interaction between the two. \n\n```{r differential expression all genes, echo=TRUE, message=FALSE, warning=FALSE}\nlibrary(\"DESeq2\")\nlibrary(\"ggplot2\")\nlibrary(\"qvalue\")\nlibrary(\"pheatmap\")\nlibrary(\"RColorBrewer\")\nlibrary(\"sva\")\nlibrary(\"PoiClaClu\")\n\n\ndirectory <- \"~/ecoli/data/ecoli_count/\"\nsampleFiles <- grep(\"count\",list.files(directory),value=TRUE)\n\nsampleCondition <-read.delim(file =\"data/sample.sheet.txt\", header =T, as.is =T, quote =\"\")\nsampleTable <- data.frame(sampleName = sampleFiles,fileName = sampleFiles,condition = sampleCondition)\nddsHTSeq <- DESeqDataSetFromHTSeqCount(sampleTable = sampleTable, directory = directory,design=~condition.Strain+condition.Time_point+condition.Strain:condition.Time_point )\nddsHTSeq\ndds <- ddsHTSeq[ rowSums(counts(ddsHTSeq)) > 1, ]\ndds <- DESeq(dds)\n\ndds <- ddsHTSeq[ rowSums(counts(ddsHTSeq)) > 1, ]\ndds <- DESeq(dds)\nddsTC <- DESeq(dds, test=\"LRT\", reduced = ~ condition.Strain+condition.Time_point)\nresTC <- results(ddsTC)\nresTC$symbol <- mcols(ddsTC)$symbol\nhead(resTC[order(resTC$pvalue),])\nsum(resTC$padj < 0.1, na.rm=TRUE)\n\n```\n\nplots -- plots for all data \n\n```{r plots all data, echo=TRUE, message=FALSE, warning=FALSE}\nrld <- rlog(dds, blind=FALSE)\n\nsampleDists <- dist( t( assay(rld) ) )\nsampleDistMatrix <- as.matrix( sampleDists )\nrownames(sampleDistMatrix) <-paste(sampleCondition[,1],sampleCondition[,2],sampleCondition[,4], sep =\".\") \ncolnames(sampleDistMatrix) <- NULL\ncolors <- colorRampPalette( rev(brewer.pal(9, \"Blues\")) )(255)\npheatmap(sampleDistMatrix,\n         clustering_distance_rows=sampleDists,\n         clustering_distance_cols=sampleDists,\n         col=colors)\n\npoisd <- PoissonDistance(t(counts(dds)))\n\nsamplePoisDistMatrix <- as.matrix( poisd$dd )\nrownames(samplePoisDistMatrix) <- paste(sampleCondition[,1],sampleCondition[,2],sampleCondition[,4], sep =\".\") \ncolnames(samplePoisDistMatrix) <- NULL\npheatmap(samplePoisDistMatrix,\n         clustering_distance_rows=poisd$dd,\n         clustering_distance_cols=poisd$dd,\n         col=colors)\n\nplotPCA(rld, intgroup = c(\"condition.Strain\", \"condition.Time_point\"))\n\npcaData <- plotPCA(rld, intgroup = c( \"condition.Strain\", \"condition.Time_point\"), returnData=TRUE)\npercentVar <- round(100 * attr(pcaData, \"percentVar\"))\n\nggplot(pcaData, aes(PC1, PC2, color=condition.Strain, shape=condition.Time_point)) + geom_point(size=3) +\n  xlab(paste0(\"PC1: \",percentVar[1],\"% variance\")) +\n  ylab(paste0(\"PC2: \",percentVar[2],\"% variance\")) +\n  coord_fixed()\n\nmdsData <- data.frame(cmdscale(sampleDistMatrix))\nmds <- cbind(mdsData, as.data.frame(colData(rld)))\nggplot(mds, aes(X1,X2,color=condition.Strain,shape=condition.Time_point)) + geom_point(size=3) +\n  coord_fixed()\n\nmdsPoisData <- data.frame(cmdscale(samplePoisDistMatrix))\nmdsPois <- cbind(mdsPoisData, as.data.frame(colData(dds)))\nggplot(mdsPois, aes(X1,X2,color=condition.Strain,shape=condition.Time_point)) + geom_point(size=3) +\n  coord_fixed()\n\nqs <- c(0, quantile(resTC$baseMean[resTC$baseMean > 0], 0:6/6))\nbins <- cut(resTC$baseMean, qs)\nlevels(bins) <- paste0(\"~\",round(signif(.5*qs[-1] + .5*qs[-length(qs)],2)))\nratios <- tapply(resTC$pvalue, bins, function(p) mean(p < .05, na.rm=TRUE))\nbarplot(ratios, xlab=\"mean normalized count\", ylab=\"ratio of small p values\")\n\n```\n\n\n",
    "created" : 1479857431588.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "2895554565",
    "id" : "9ABCADBB",
    "lastKnownWriteTime" : 1479858710,
    "last_content_update" : 1479858710521,
    "path" : "~/ecoli/ecoli.all.Rmd",
    "project_path" : "ecoli.all.Rmd",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 2,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}